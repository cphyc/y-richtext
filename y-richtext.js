!function t(e,o,r){function n(s,u){if(!o[s]){if(!e[s]){var l="function"==typeof require&&require;if(!u&&l)return l(s,!0);if(i)return i(s,!0);throw new Error("Cannot find module '"+s+"'")}var c=o[s]={exports:{}};e[s][0].call(c.exports,function(t){var o=e[s][1][t];return n(o?o:t)},c,c.exports,t,e,o,r)}return o[s].exports}for(var i="function"==typeof require&&require,s=0;s<r.length;s++)n(r[s]);return n}({1:[function(t,e,o){var r,n,i,s,u={}.hasOwnProperty,l=function(t,e){function o(){this.constructor=t}for(var r in e)u.call(e,r)&&(t[r]=e[r]);return o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype,t};s=t("./misc.coffee"),r=function(){function t(t){this.editor=t,this.locker=new s.Locker}return t.prototype.getContents=function(){throw new Error("Implement me")},t.prototype.getCursor=function(){throw new Error("Implement me")},t.prototype.setCursor=function(t){throw new Error("Implement me")},t.prototype.observeLocalText=function(t){throw new Error("Implement me")},t.prototype.observeLocalCursor=function(t){throw new Error("Implement me")},t.prototype.updateContents=function(t){throw new Error("Implement me")},t.prototype.setContents=function(t){throw new Error("Implement me")},t.prototype.getEditor=function(){throw new Error("Implement me")},t}(),n=function(t){function e(t){this.editor=t,e.__super__.constructor.call(this,this.editor),this._cursors=this.editor.getModule("multi-cursor")}return l(e,t),e.prototype.getLength=function(){return this.editor.getLength()},e.prototype.getCursorPosition=function(){var t;return t=this.editor.getSelection(),t?t.start:0},e.prototype.getContents=function(){return this.editor.getContents().ops},e.prototype.setCursor=function(t){return this.locker["try"](function(e){return function(){return null!=t.index?e._cursors.setCursor(t.id,t.index,t.text,t.color):void 0}}(this))},e.prototype.observeLocalText=function(t){return this.editor.on("text-change",function(e,o){var r;return r=t(e.ops),this.editor.selection.emitter.emit(this.editor.selection.emitter.constructor.events.SELECTION_CHANGE,this.editor.quill.getSelection(),"user")})},e.prototype.observeLocalCursor=function(t){return this.editor.on("selection-change",function(e,o){return e&&e.start===e.end?t(e.start):void 0})},e.prototype.updateContents=function(t){return this.editor.updateContents(t)},e.prototype.setContents=function(t){return this.editor.setContents(t)},e.prototype.getEditor=function(){return this.editor},e}(r),i=function(t){function e(t){this.editor=t,e.__super__.constructor.apply(this,arguments)}return l(e,t),e.prototype.getLength=function(){return 0},e.prototype.getCursorPosition=function(){return 0},e.prototype.getContents=function(){return{ops:[{insert:"Well, this is a test!"},{insert:"And I'm boldâ€¦",attributes:{bold:!0}}]}},e.prototype.setCursor=function(){return""},e.prototype.observeLocalText=function(t){return""},e.prototype.observeLocalCursor=function(t){return""},e.prototype.updateContents=function(t){return""},e.prototype.setContents=function(t){return""},e.prototype.getEditor=function(){return this.editor},e}(r),o.QuillJs=n,o.TestEditor=i,o.AbstractEditor=r},{"./misc.coffee":2}],2:[function(t,e,o){var r,n;n=function(){function t(){this.is_locked=!1}return t.prototype["try"]=function(t){var e;if(!this.is_locked)return this.is_locked=!0,e=t(),this.is_locked=!1,e},t}(),r=function(){function t(){this._tmp_model={}}return t.prototype._get=function(t){return null==this._model?this._tmp_model[t]:this._model.val(t)},t.prototype._set=function(t,e){return null==this._model?this._tmp_model[t]=e:this._model.val(t,e)},t.prototype._getModel=function(t,e){var o,r,n;if(null==this._model){this._model=new e.MapManager(this).execute(),n=this._tmp_model;for(o in n)r=n[o],this._model.val(o,r)}return this._model},t.prototype._setModel=function(t){return this._model=t,delete this._tmp_model},t}(),"undefined"!=typeof e&&null!==e&&(o.BaseClass=r,o.Locker=n)},{}],3:[function(t,e,o){var r,n,i,s,u,l=function(t,e){return function(){return t.apply(e,arguments)}},c={}.hasOwnProperty,p=function(t,e){function o(){this.constructor=t}for(var r in e)c.call(e,r)&&(t[r]=e[r]);return o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype,t};if(u=t("./misc.coffee"),r=u.BaseClass,i=u.Locker,n=t("./editors.coffee"),s=function(t){function e(t,e){this.updateCursorPosition=l(this.updateCursorPosition,this),this.passDeltas=l(this.passDeltas,this),this.locker=new i,null!=t&&null!=e&&(this._bind_later={name:t,instance:e})}var o,r,s;return p(e,t),e.prototype.bind=function(){var t,e,o;if(arguments[0]instanceof n.AbstractEditor)this.editor=arguments[0];else{if(o=arguments[0],e=arguments[1],null!=this.editor&&this.editor.getEditor()===e)return;if(t=n[o],null==t)throw new Error("This type of editor is not supported! ("+o+")");this.editor=new t(e)}return this.editor.setContents({ops:this.getDelta()}),this.editor.observeLocalText(this.passDeltas),this.bindEventsToEditor(this.editor),this.editor.observeLocalCursor(this.updateCursorPosition)},e.prototype.getDelta=function(){var t,e,o,r,n,i,s,u,l;for(n=this._model.getContent("characters").val(),e=0,t=[],l=this._model.getContent("selections").getSelections(this._model.getContent("characters")),s=0,u=l.length;u>s;s++){if(o=l[s],r=o.to-o.from+1,e!==o.from&&(i=n.splice(0,o.from-e).join(""),t.push({insert:i}),e+=i.length),e!==o.from)throw new Error("This portion of code must not be reached in getDelta!");t.push({insert:n.splice(0,r).join(""),attributes:o.attrs}),e+=r}return n.length>0&&t.push({insert:n.join("")}),t},e.prototype._getModel=function(t,e){var o,r,i;if(null==this._model){if(r={selections:new t.Selections,characters:new t.List,cursors:new t.Object},this._model=new e.MapManager(this,null,{},r).execute(),this._setModel(this._model),null!=this._bind_later){if(o=n[this._bind_later.name],null==o)throw new Error("This type of editor is not supported! ("+editor_name+") -- fatal error!");i=new o(this._bind_later.instance),this.passDeltas(i.getContents()),this.bind(i),delete this._bind_later}this._model.observe(this.propagateToEditor)}return this._model},e.prototype._setModel=function(t){return e.__super__._setModel.apply(this,arguments)},e.prototype._name="RichText",e.prototype.getText=function(){return this._model.getContent("characters").val().join("")},e.prototype.setCursor=function(t){return this.selfCursor=this._model.getContent("characters").ref(t),this._model.getContent("cursors").val(this._model.HB.getUserId(),this.selfCursor)},e.prototype.passDeltas=function(t){return this.locker["try"](function(e){return function(){var o,n,i,s,u;for(n=0,console.log(t),u=[],i=0,s=t.length;s>i;i++)o=t[i],u.push(n=r(e,o,n));return u}}(this))},e.prototype.updateCursorPosition=function(t){return this.locker["try"](function(e){return function(){return e.selfCursor="number"==typeof t?e._model.getContent("characters").ref(t):t,e._model.getContent("cursors").val(e._model.HB.getUserId(),e.selfCursor)}}(this))},e.prototype.bindEventsToEditor=function(t){return this._model.getContent("characters").observe(function(t){return function(e){return t.locker["try"](function(){var o,r,n,i,s;for(s=[],n=0,i=e.length;i>n;n++)r=e[n],o={ops:[{retain:r.position}]},"insert"===r.type?o.ops.push({insert:r.value}):"delete"===r.type&&o.ops.push({"delete":1}),s.push(t.editor.updateContents(o));return s})}}(this)),this._model.getContent("selections").observe(function(t){return function(e){return t.locker["try"](function(){var o,r,n,i,s,u,l,c,p;if(r={},"select"===e.type){c=e.attrs;for(o in c)s=c[o],r[o]=s}else for(p=e.attrs,u=0,l=p.length;l>u;u++)o=p[u],r[o]=null;return n=e.from.getPosition(),i=e.to.getPosition()-e.from.getPosition()+1,t.editor.updateContents({ops:[{retain:n},{retain:i,attributes:r}]})})}}(this)),this._model.getContent("cursors").observe(function(t){return function(e){return t.locker["try"](function(){var o,r,n,i,s,u,l;for(u=0,l=e.length;l>u;u++){if(r=e[u],o=r.changedBy,s=r.object.val(o),null===s)i=t.editor.getLength();else{if(null==s)return void console.warn("ref_to_char is undefined");i=s.getPosition()}n={id:o,index:i,text:o,color:"grey"},t.editor.setCursor(n)}})}}(this))},r=function(t,e,r){var n,i,u,l,c,p,f,h,a,d,m;if(null==r&&(r=0),null!=e){h=t._model.getContent("selections"),u=[],i={},m=e.attributes;for(p in m)d=m[p],null!=d?i[p]=d:u.push(p);if(null!=e.insert)return c=e.insert,n=function(){if("string"==typeof c)return c.split("");if("number"==typeof c)return[c];throw new Error("Got an unexpected value in delta.insert! ("+typeof content+")")}(),s(t,r,n),l=t._model.getContent("characters").ref(r),a=t._model.getContent("characters").ref(r+n.length-1),null!=e.attributes&&(t._model.getContent("selections").select(l,a,i,!0),t._model.getContent("selections").unselect(l,a,u)),r+n.length;if(null!=e["delete"])return o(t,r,e["delete"]),r;if(null!=e.retain)return f=parseInt(e.retain),l=t._model.getContent("characters").ref(r),a=t._model.getContent("characters").ref(r+f-1),t._model.getContent("selections").select(l,a,i),t._model.getContent("selections").unselect(l,a,u),r+f;throw new Error("This part of code must not be reached!")}},s=function(t,e,o){return t._model.getContent("characters").insertContents(e,o)},o=function(t,e,o){return null==o&&(o=1),t._model.getContent("characters")["delete"](e,o)},e}(r),"undefined"!=typeof window&&null!==window){if(null==window.Y)throw new Error("You must first import Y!");window.Y.RichText=s}"undefined"!=typeof e&&null!==e&&(e.exports=s)},{"./editors.coffee":1,"./misc.coffee":2}]},{},[3]);